/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/chat";
exports.ids = ["pages/api/chat"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "whatwg-fetch":
/*!*******************************!*\
  !*** external "whatwg-fetch" ***!
  \*******************************/
/***/ ((module) => {

"use strict";
module.exports = require("whatwg-fetch");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ "@langchain/core/embeddings":
/*!*********************************************!*\
  !*** external "@langchain/core/embeddings" ***!
  \*********************************************/
/***/ ((module) => {

"use strict";
module.exports = import("@langchain/core/embeddings");;

/***/ }),

/***/ "@langchain/core/language_models/base":
/*!*******************************************************!*\
  !*** external "@langchain/core/language_models/base" ***!
  \*******************************************************/
/***/ ((module) => {

"use strict";
module.exports = import("@langchain/core/language_models/base");;

/***/ }),

/***/ "@langchain/core/language_models/chat_models":
/*!**************************************************************!*\
  !*** external "@langchain/core/language_models/chat_models" ***!
  \**************************************************************/
/***/ ((module) => {

"use strict";
module.exports = import("@langchain/core/language_models/chat_models");;

/***/ }),

/***/ "@langchain/core/messages":
/*!*******************************************!*\
  !*** external "@langchain/core/messages" ***!
  \*******************************************/
/***/ ((module) => {

"use strict";
module.exports = import("@langchain/core/messages");;

/***/ }),

/***/ "@langchain/core/output_parsers":
/*!*************************************************!*\
  !*** external "@langchain/core/output_parsers" ***!
  \*************************************************/
/***/ ((module) => {

"use strict";
module.exports = import("@langchain/core/output_parsers");;

/***/ }),

/***/ "@langchain/core/output_parsers/openai_tools":
/*!**************************************************************!*\
  !*** external "@langchain/core/output_parsers/openai_tools" ***!
  \**************************************************************/
/***/ ((module) => {

"use strict";
module.exports = import("@langchain/core/output_parsers/openai_tools");;

/***/ }),

/***/ "@langchain/core/outputs":
/*!******************************************!*\
  !*** external "@langchain/core/outputs" ***!
  \******************************************/
/***/ ((module) => {

"use strict";
module.exports = import("@langchain/core/outputs");;

/***/ }),

/***/ "@langchain/core/runnables":
/*!********************************************!*\
  !*** external "@langchain/core/runnables" ***!
  \********************************************/
/***/ ((module) => {

"use strict";
module.exports = import("@langchain/core/runnables");;

/***/ }),

/***/ "@langchain/core/utils/chunk_array":
/*!****************************************************!*\
  !*** external "@langchain/core/utils/chunk_array" ***!
  \****************************************************/
/***/ ((module) => {

"use strict";
module.exports = import("@langchain/core/utils/chunk_array");;

/***/ }),

/***/ "@langchain/core/utils/env":
/*!********************************************!*\
  !*** external "@langchain/core/utils/env" ***!
  \********************************************/
/***/ ((module) => {

"use strict";
module.exports = import("@langchain/core/utils/env");;

/***/ }),

/***/ "@langchain/core/utils/function_calling":
/*!*********************************************************!*\
  !*** external "@langchain/core/utils/function_calling" ***!
  \*********************************************************/
/***/ ((module) => {

"use strict";
module.exports = import("@langchain/core/utils/function_calling");;

/***/ }),

/***/ "@langchain/core/utils/json_schema":
/*!****************************************************!*\
  !*** external "@langchain/core/utils/json_schema" ***!
  \****************************************************/
/***/ ((module) => {

"use strict";
module.exports = import("@langchain/core/utils/json_schema");;

/***/ }),

/***/ "@langchain/core/utils/stream":
/*!***********************************************!*\
  !*** external "@langchain/core/utils/stream" ***!
  \***********************************************/
/***/ ((module) => {

"use strict";
module.exports = import("@langchain/core/utils/stream");;

/***/ }),

/***/ "@langchain/core/utils/types":
/*!**********************************************!*\
  !*** external "@langchain/core/utils/types" ***!
  \**********************************************/
/***/ ((module) => {

"use strict";
module.exports = import("@langchain/core/utils/types");;

/***/ }),

/***/ "langchain/vectorstores/memory":
/*!************************************************!*\
  !*** external "langchain/vectorstores/memory" ***!
  \************************************************/
/***/ ((module) => {

"use strict";
module.exports = import("langchain/vectorstores/memory");;

/***/ }),

/***/ "p-retry":
/*!**************************!*\
  !*** external "p-retry" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = import("p-retry");;

/***/ }),

/***/ "uuid":
/*!***********************!*\
  !*** external "uuid" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = import("uuid");;

/***/ }),

/***/ "zod":
/*!**********************!*\
  !*** external "zod" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = import("zod");;

/***/ }),

/***/ "zod/v4/core":
/*!******************************!*\
  !*** external "zod/v4/core" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = import("zod/v4/core");;

/***/ }),

/***/ "(api)/__barrel_optimize__?names=ChatOllama!=!./node_modules/@langchain/ollama/index.js":
/*!****************************************************************************************!*\
  !*** __barrel_optimize__?names=ChatOllama!=!./node_modules/@langchain/ollama/index.js ***!
  \****************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ChatOllama: () => (/* reexport safe */ _home_saif_dc_DC_projects_react_node_js_dcastalia_chatbot_node_modules_langchain_ollama_dist_chat_models_js__WEBPACK_IMPORTED_MODULE_0__.ChatOllama)
/* harmony export */ });
/* harmony import */ var _home_saif_dc_DC_projects_react_node_js_dcastalia_chatbot_node_modules_langchain_ollama_dist_chat_models_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./node_modules/@langchain/ollama/dist/chat_models.js */ "(api)/./node_modules/@langchain/ollama/dist/chat_models.js");
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_home_saif_dc_DC_projects_react_node_js_dcastalia_chatbot_node_modules_langchain_ollama_dist_chat_models_js__WEBPACK_IMPORTED_MODULE_0__]);
_home_saif_dc_DC_projects_react_node_js_dcastalia_chatbot_node_modules_langchain_ollama_dist_chat_models_js__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];


__webpack_async_result__();
} catch(e) { __webpack_async_result__(e); } });

/***/ }),

/***/ "(api)/__barrel_optimize__?names=ChatOpenAI!=!./node_modules/@langchain/openai/index.js":
/*!****************************************************************************************!*\
  !*** __barrel_optimize__?names=ChatOpenAI!=!./node_modules/@langchain/openai/index.js ***!
  \****************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ChatOpenAI: () => (/* reexport safe */ _home_saif_dc_DC_projects_react_node_js_dcastalia_chatbot_node_modules_langchain_openai_dist_chat_models_js__WEBPACK_IMPORTED_MODULE_0__.ChatOpenAI)
/* harmony export */ });
/* harmony import */ var _home_saif_dc_DC_projects_react_node_js_dcastalia_chatbot_node_modules_langchain_openai_dist_chat_models_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./node_modules/@langchain/openai/dist/chat_models.js */ "(api)/./node_modules/@langchain/openai/dist/chat_models.js");
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_home_saif_dc_DC_projects_react_node_js_dcastalia_chatbot_node_modules_langchain_openai_dist_chat_models_js__WEBPACK_IMPORTED_MODULE_0__]);
_home_saif_dc_DC_projects_react_node_js_dcastalia_chatbot_node_modules_langchain_openai_dist_chat_models_js__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];


__webpack_async_result__();
} catch(e) { __webpack_async_result__(e); } });

/***/ }),

/***/ "(api)/__barrel_optimize__?names=OllamaEmbeddings!=!./node_modules/@langchain/ollama/index.js":
/*!**********************************************************************************************!*\
  !*** __barrel_optimize__?names=OllamaEmbeddings!=!./node_modules/@langchain/ollama/index.js ***!
  \**********************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   OllamaEmbeddings: () => (/* reexport safe */ _home_saif_dc_DC_projects_react_node_js_dcastalia_chatbot_node_modules_langchain_ollama_dist_embeddings_js__WEBPACK_IMPORTED_MODULE_0__.OllamaEmbeddings)
/* harmony export */ });
/* harmony import */ var _home_saif_dc_DC_projects_react_node_js_dcastalia_chatbot_node_modules_langchain_ollama_dist_embeddings_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./node_modules/@langchain/ollama/dist/embeddings.js */ "(api)/./node_modules/@langchain/ollama/dist/embeddings.js");
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_home_saif_dc_DC_projects_react_node_js_dcastalia_chatbot_node_modules_langchain_ollama_dist_embeddings_js__WEBPACK_IMPORTED_MODULE_0__]);
_home_saif_dc_DC_projects_react_node_js_dcastalia_chatbot_node_modules_langchain_ollama_dist_embeddings_js__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];


__webpack_async_result__();
} catch(e) { __webpack_async_result__(e); } });

/***/ }),

/***/ "(api)/__barrel_optimize__?names=OpenAIEmbeddings!=!./node_modules/@langchain/openai/index.js":
/*!**********************************************************************************************!*\
  !*** __barrel_optimize__?names=OpenAIEmbeddings!=!./node_modules/@langchain/openai/index.js ***!
  \**********************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   OpenAIEmbeddings: () => (/* reexport safe */ _home_saif_dc_DC_projects_react_node_js_dcastalia_chatbot_node_modules_langchain_openai_dist_embeddings_js__WEBPACK_IMPORTED_MODULE_0__.OpenAIEmbeddings)
/* harmony export */ });
/* harmony import */ var _home_saif_dc_DC_projects_react_node_js_dcastalia_chatbot_node_modules_langchain_openai_dist_embeddings_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./node_modules/@langchain/openai/dist/embeddings.js */ "(api)/./node_modules/@langchain/openai/dist/embeddings.js");
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_home_saif_dc_DC_projects_react_node_js_dcastalia_chatbot_node_modules_langchain_openai_dist_embeddings_js__WEBPACK_IMPORTED_MODULE_0__]);
_home_saif_dc_DC_projects_react_node_js_dcastalia_chatbot_node_modules_langchain_openai_dist_embeddings_js__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];


__webpack_async_result__();
} catch(e) { __webpack_async_result__(e); } });

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fchat.js&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fchat.js&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_chat_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/chat.js */ \"(api)/./pages/api/chat.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_chat_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_chat_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_chat_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_chat_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/chat\",\n        pathname: \"/api/chat\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_chat_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmNoYXQmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyUyRmFwaSUyRmNoYXQuanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDZ0Q7QUFDaEQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLCtDQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQywrQ0FBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kY2FzdGFsaWEtY2hhdGJvdC8/N2FkMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXMvYXBpL2NoYXQuanNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9jaGF0XCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvY2hhdFwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fchat.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./styles/globals.css":
/*!****************************!*\
  !*** ./styles/globals.css ***!
  \****************************/
/***/ (() => {



/***/ }),

/***/ "(api)/./lib/indexer.js":
/*!************************!*\
  !*** ./lib/indexer.js ***!
  \************************/
/***/ ((__webpack_module__, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(__webpack_module__, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   getVectorStoreStatus: () => (/* binding */ getVectorStoreStatus),\n/* harmony export */   loadIndex: () => (/* binding */ loadIndex),\n/* harmony export */   refreshVectorStore: () => (/* binding */ refreshVectorStore)\n/* harmony export */ });\n/* harmony import */ var _barrel_optimize_names_OpenAIEmbeddings_langchain_openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! __barrel_optimize__?names=OpenAIEmbeddings!=!@langchain/openai */ \"(api)/__barrel_optimize__?names=OpenAIEmbeddings!=!./node_modules/@langchain/openai/index.js\");\n/* harmony import */ var _barrel_optimize_names_OllamaEmbeddings_langchain_ollama__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! __barrel_optimize__?names=OllamaEmbeddings!=!@langchain/ollama */ \"(api)/__barrel_optimize__?names=OllamaEmbeddings!=!./node_modules/@langchain/ollama/index.js\");\n/* harmony import */ var langchain_vectorstores_memory__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! langchain/vectorstores/memory */ \"langchain/vectorstores/memory\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! path */ \"path\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_barrel_optimize_names_OpenAIEmbeddings_langchain_openai__WEBPACK_IMPORTED_MODULE_0__, _barrel_optimize_names_OllamaEmbeddings_langchain_ollama__WEBPACK_IMPORTED_MODULE_1__, langchain_vectorstores_memory__WEBPACK_IMPORTED_MODULE_2__]);\n([_barrel_optimize_names_OpenAIEmbeddings_langchain_openai__WEBPACK_IMPORTED_MODULE_0__, _barrel_optimize_names_OllamaEmbeddings_langchain_ollama__WEBPACK_IMPORTED_MODULE_1__, langchain_vectorstores_memory__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n// Configuration object for better maintainability\nconst CONFIG = {\n    MAX_ENTRIES: process.env.MAX_VECTOR_ENTRIES ? parseInt(process.env.MAX_VECTOR_ENTRIES) : 100,\n    MAX_CONTENT_LENGTH: process.env.MAX_CONTENT_LENGTH ? parseInt(process.env.MAX_CONTENT_LENGTH) : 800,\n    MIN_CONTENT_LENGTH: process.env.MIN_CONTENT_LENGTH ? parseInt(process.env.MIN_CONTENT_LENGTH) : 50,\n    DATA_FILE_PATH: process.env.DATA_FILE_PATH || \"app/data/dcastalia.json\",\n    LLM_PROVIDER: process.env.LLM_PROVIDER || \"ollama\",\n    EMBEDDING_MODEL: process.env.EMBEDDING_MODEL || \"mistral\",\n    OPENAI_EMBEDDING_MODEL: process.env.OPENAI_EMBEDDING_MODEL || \"text-embedding-3-small\"\n};\n// Cache management\nlet vectorStore = null;\nlet lastDataHash = null;\nlet lastLoadTime = null;\n// Content cleaning patterns - organized for better maintainability\nconst CLEANING_PATTERNS = {\n    // HTML and markup removal\n    htmlTags: /<[^>]*>/g,\n    whitespace: /\\s+/g,\n    // JavaScript removal patterns\n    functions: /function\\s+\\w+\\s*\\([^)]*\\)\\s*\\{[^}]*\\}/g,\n    jquery: /jQuery\\([^)]*\\)[^;]*;/g,\n    gtag: /gtag\\([^)]*\\)/g,\n    dataLayer: /window\\.dataLayer[^;]*;/g,\n    setTimeout: /setTimeout\\([^)]*\\)/g,\n    // CSS removal patterns\n    cssRules: /\\.[a-zA-Z0-9_-]+\\s*\\{[^}]*\\}/g,\n    mediaQueries: /@media[^}]*\\{[^}]*\\}/g,\n    // Common unwanted content patterns\n    copyright: /© \\d{4} [^.]*/g,\n    navigation: /Toggle navigation[^.]*/g,\n    iframes: /<iframe[^>]*>/g,\n    srcAttributes: /src=\"[^\"]*\"/g\n};\n// Unwanted phrases that indicate low-quality content\nconst FILTER_PHRASES = [\n    \"function\",\n    \"jQuery\",\n    \"gtag\",\n    \"setTimeout\",\n    \"\\xa9\",\n    \"Toggle navigation\",\n    \"Get in Touch\",\n    \"Services\",\n    \"About\",\n    \"Contact\",\n    \"Inspiring Innovation\"\n];\n/**\n * Enhanced content cleaning with better error handling and performance\n */ function cleanContent(content) {\n    if (!content || typeof content !== \"string\") {\n        return \"No content available\";\n    }\n    try {\n        let cleaned = content;\n        // Apply all cleaning patterns\n        Object.values(CLEANING_PATTERNS).forEach((pattern)=>{\n            cleaned = cleaned.replace(pattern, \" \");\n        });\n        // Split into sentences and filter out unwanted content\n        const sentences = cleaned.split(/[.!?]/).map((sentence)=>sentence.trim()).filter((sentence)=>{\n            if (sentence.length < 15) return false;\n            // Check for unwanted phrases\n            const lowerSentence = sentence.toLowerCase();\n            return !FILTER_PHRASES.some((phrase)=>lowerSentence.includes(phrase.toLowerCase()));\n        });\n        // Rejoin sentences\n        cleaned = sentences.join(\". \").trim();\n        // Fallback if cleaning removed too much content\n        if (cleaned.length < CONFIG.MIN_CONTENT_LENGTH) {\n            cleaned = content.replace(CLEANING_PATTERNS.htmlTags, \" \").replace(CLEANING_PATTERNS.whitespace, \" \").trim();\n        }\n        // Apply length limits\n        if (cleaned.length > CONFIG.MAX_CONTENT_LENGTH) {\n            // Try to cut at sentence boundary\n            const cutPoint = cleaned.lastIndexOf(\". \", CONFIG.MAX_CONTENT_LENGTH);\n            cleaned = cutPoint > CONFIG.MAX_CONTENT_LENGTH * 0.8 ? cleaned.substring(0, cutPoint + 1) : cleaned.substring(0, CONFIG.MAX_CONTENT_LENGTH) + \"...\";\n        }\n        return cleaned || \"No meaningful content found\";\n    } catch (error) {\n        console.error(\"Error cleaning content:\", error.message);\n        // Robust fallback\n        try {\n            return content.replace(CLEANING_PATTERNS.htmlTags, \" \").replace(CLEANING_PATTERNS.whitespace, \" \").trim().substring(0, CONFIG.MAX_CONTENT_LENGTH) + \"...\";\n        } catch (fallbackError) {\n            console.error(\"Fallback cleaning also failed:\", fallbackError.message);\n            return \"Content processing failed\";\n        }\n    }\n}\n/**\n * Create efficient hash for change detection\n */ function createDataHash(data) {\n    try {\n        // Create hash from URLs, content lengths, and modification indicators\n        const hashInput = data.map((entry)=>`${entry.url || \"no-url\"}:${(entry.content || \"\").length}`).join(\"|\");\n        return crypto__WEBPACK_IMPORTED_MODULE_4__.createHash(\"md5\").update(hashInput).digest(\"hex\").substring(0, 16);\n    } catch (error) {\n        console.error(\"Error creating data hash:\", error.message);\n        return Date.now().toString(); // Fallback to timestamp\n    }\n}\n/**\n * Validate and load data file\n */ async function loadDataFile() {\n    try {\n        // Check if file exists\n        await fs__WEBPACK_IMPORTED_MODULE_3__.promises.access(CONFIG.DATA_FILE_PATH);\n        const fileContent = await fs__WEBPACK_IMPORTED_MODULE_3__.promises.readFile(CONFIG.DATA_FILE_PATH, \"utf8\");\n        const data = JSON.parse(fileContent);\n        if (!Array.isArray(data)) {\n            throw new Error(\"Data file must contain an array\");\n        }\n        console.log(`✓ Data file loaded: ${data.length} entries`);\n        return data;\n    } catch (error) {\n        if (error.code === \"ENOENT\") {\n            throw new Error(`Data file not found: ${CONFIG.DATA_FILE_PATH}`);\n        } else if (error instanceof SyntaxError) {\n            throw new Error(`Invalid JSON in data file: ${error.message}`);\n        }\n        throw error;\n    }\n}\n/**\n * Filter data based on content quality\n */ function filterDataByQuality(data) {\n    const qualityChecks = {\n        hasContent: (entry)=>entry.content && entry.content.length > 0,\n        hasUrl: (entry)=>entry.url && typeof entry.url === \"string\",\n        hasMinLength: (entry)=>entry.content.length >= CONFIG.MIN_CONTENT_LENGTH,\n        notErrorContent: (entry)=>!entry.content.includes(\"Content unavailable\") && !entry.content.includes(\"No content available\") && !entry.content.includes(\"Error processing\"),\n        hasVariedContent: (entry)=>{\n            // Check for content diversity (not just repeated phrases)\n            const words = entry.content.toLowerCase().split(/\\s+/);\n            const uniqueWords = new Set(words);\n            return uniqueWords.size >= words.length * 0.3; // At least 30% unique words\n        }\n    };\n    const filtered = data.filter((entry, index)=>{\n        const checks = Object.entries(qualityChecks);\n        const failedChecks = checks.filter(([name, check])=>!check(entry));\n        if (failedChecks.length > 0) {\n            console.log(`⚠ Filtering entry ${index + 1}: Failed ${failedChecks.map(([name])=>name).join(\", \")}`);\n            return false;\n        }\n        return true;\n    });\n    console.log(`✓ Quality filter: ${filtered.length}/${data.length} entries passed`);\n    return filtered;\n}\n/**\n * Initialize embeddings provider\n */ function createEmbeddings() {\n    try {\n        const provider = CONFIG.LLM_PROVIDER.toLowerCase();\n        switch(provider){\n            case \"openai\":\n                return new _barrel_optimize_names_OpenAIEmbeddings_langchain_openai__WEBPACK_IMPORTED_MODULE_0__.OpenAIEmbeddings({\n                    modelName: CONFIG.OPENAI_EMBEDDING_MODEL\n                });\n            case \"ollama\":\n            default:\n                return new _barrel_optimize_names_OllamaEmbeddings_langchain_ollama__WEBPACK_IMPORTED_MODULE_1__.OllamaEmbeddings({\n                    model: CONFIG.EMBEDDING_MODEL\n                });\n        }\n    } catch (error) {\n        console.error(\"Error creating embeddings provider:\", error.message);\n        // Fallback to Ollama\n        return new _barrel_optimize_names_OllamaEmbeddings_langchain_ollama__WEBPACK_IMPORTED_MODULE_1__.OllamaEmbeddings({\n            model: \"mistral\"\n        });\n    }\n}\n/**\n * Process data for vector store creation\n */ function processDataForVectorStore(data) {\n    console.log(\"\\uD83D\\uDD04 Processing content...\");\n    const processed = data.map((entry, index)=>{\n        try {\n            const cleaned = cleanContent(entry.content);\n            if (index % 10 === 0) {\n                console.log(`Processing ${index + 1}/${data.length}...`);\n            }\n            return {\n                text: cleaned,\n                metadata: {\n                    url: entry.url,\n                    originalLength: entry.content ? entry.content.length : 0,\n                    cleanedLength: cleaned.length,\n                    index: index\n                }\n            };\n        } catch (error) {\n            console.error(`Error processing entry ${index + 1}:`, error.message);\n            return {\n                text: \"Error processing content\",\n                metadata: {\n                    url: entry.url || \"unknown\",\n                    error: true,\n                    index: index\n                }\n            };\n        }\n    });\n    const texts = processed.map((p)=>p.text);\n    const metadatas = processed.map((p)=>p.metadata);\n    console.log(\"✓ Content processing completed\");\n    return {\n        texts,\n        metadatas\n    };\n}\n/**\n * Dispose of existing vector store to free memory\n */ function disposeVectorStore() {\n    if (vectorStore) {\n        console.log(\"\\uD83D\\uDDD1️ Disposing old vector store\");\n        vectorStore = null;\n        // Force garbage collection if available (Node.js with --expose-gc)\n        if (global.gc) {\n            global.gc();\n        }\n    }\n}\n/**\n * Main function to load and create vector index\n */ async function loadIndex() {\n    const startTime = Date.now();\n    try {\n        console.log(\"\\uD83D\\uDE80 Starting vector store creation...\");\n        console.log(`📋 Config: ${CONFIG.MAX_ENTRIES} max entries, ${CONFIG.LLM_PROVIDER} provider`);\n        // Load and validate data\n        const rawData = await loadDataFile();\n        // Check cache validity\n        const currentHash = createDataHash(rawData);\n        const cacheAge = lastLoadTime ? Date.now() - lastLoadTime : Infinity;\n        const maxCacheAge = 5 * 60 * 1000; // 5 minutes\n        if (vectorStore && lastDataHash === currentHash && cacheAge < maxCacheAge) {\n            console.log(\"✅ Using cached vector store\");\n            return vectorStore;\n        }\n        // Dispose old vector store\n        disposeVectorStore();\n        // Filter and limit data\n        const qualityData = filterDataByQuality(rawData);\n        const limitedData = qualityData.slice(0, CONFIG.MAX_ENTRIES);\n        if (limitedData.length < qualityData.length) {\n            console.log(`⚠️ Limited to ${CONFIG.MAX_ENTRIES} entries (${qualityData.length} available)`);\n        }\n        if (limitedData.length === 0) {\n            throw new Error(\"No valid data entries found after filtering\");\n        }\n        // Process data\n        const { texts, metadatas } = processDataForVectorStore(limitedData);\n        // Create embeddings and vector store\n        console.log(\"\\uD83D\\uDD24 Creating embeddings...\");\n        const embeddings = createEmbeddings();\n        console.log(\"\\uD83D\\uDCCA Building vector store...\");\n        vectorStore = await langchain_vectorstores_memory__WEBPACK_IMPORTED_MODULE_2__.MemoryVectorStore.fromTexts(texts, metadatas, embeddings);\n        // Update cache info\n        lastDataHash = currentHash;\n        lastLoadTime = Date.now();\n        const duration = ((Date.now() - startTime) / 1000).toFixed(2);\n        console.log(`✅ Vector store created successfully in ${duration}s`);\n        console.log(`📈 Processed ${limitedData.length} entries`);\n        return vectorStore;\n    } catch (error) {\n        const duration = ((Date.now() - startTime) / 1000).toFixed(2);\n        console.error(`❌ Error in loadIndex after ${duration}s:`, error.message);\n        // Clean up on error\n        disposeVectorStore();\n        // Re-throw with more context\n        throw new Error(`Vector store creation failed: ${error.message}`);\n    }\n}\n/**\n * Get current vector store status\n */ function getVectorStoreStatus() {\n    return {\n        isLoaded: !!vectorStore,\n        lastLoadTime,\n        lastDataHash,\n        config: CONFIG\n    };\n}\n/**\n * Force refresh of vector store\n */ async function refreshVectorStore() {\n    console.log(\"\\uD83D\\uDD04 Forcing vector store refresh...\");\n    disposeVectorStore();\n    lastDataHash = null;\n    lastLoadTime = null;\n    return await loadIndex();\n}\n// Default export for Next.js compatibility\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({\n    loadIndex,\n    getVectorStoreStatus,\n    refreshVectorStore\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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T0FBTyxDQUFDLENBQUM7SUFDcEU7QUFDSjtBQUVBOztDQUVDLEdBQ00sU0FBU3lFO0lBQ1osT0FBTztRQUNIQyxVQUFVLENBQUMsQ0FBQ3RIO1FBQ1pFO1FBQ0FEO1FBQ0FzSCxRQUFRbkk7SUFDWjtBQUNKO0FBRUE7O0NBRUMsR0FDTSxlQUFlb0k7SUFDbEI3RSxRQUFRdUIsR0FBRyxDQUFDO0lBQ1prQztJQUNBbkcsZUFBZTtJQUNmQyxlQUFlO0lBQ2YsT0FBTyxNQUFNcUc7QUFDakI7QUFFQSwyQ0FBMkM7QUFDM0MsaUVBQWU7SUFDWEE7SUFDQWM7SUFDQUc7QUFDSixDQUFDLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kY2FzdGFsaWEtY2hhdGJvdC8uL2xpYi9pbmRleGVyLmpzPzQ3ZmIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT3BlbkFJRW1iZWRkaW5ncyB9IGZyb20gXCJAbGFuZ2NoYWluL29wZW5haVwiO1xuaW1wb3J0IHsgT2xsYW1hRW1iZWRkaW5ncyB9IGZyb20gXCJAbGFuZ2NoYWluL29sbGFtYVwiO1xuaW1wb3J0IHsgTWVtb3J5VmVjdG9yU3RvcmUgfSBmcm9tIFwibGFuZ2NoYWluL3ZlY3RvcnN0b3Jlcy9tZW1vcnlcIjtcbmltcG9ydCB7IHByb21pc2VzIGFzIGZzIH0gZnJvbSBcImZzXCI7XG5pbXBvcnQgY3J5cHRvIGZyb20gXCJjcnlwdG9cIjtcbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XG5cbi8vIENvbmZpZ3VyYXRpb24gb2JqZWN0IGZvciBiZXR0ZXIgbWFpbnRhaW5hYmlsaXR5XG5jb25zdCBDT05GSUcgPSB7XG4gICAgTUFYX0VOVFJJRVM6IHByb2Nlc3MuZW52Lk1BWF9WRUNUT1JfRU5UUklFUyA/IHBhcnNlSW50KHByb2Nlc3MuZW52Lk1BWF9WRUNUT1JfRU5UUklFUykgOiAxMDAsXG4gICAgTUFYX0NPTlRFTlRfTEVOR1RIOiBwcm9jZXNzLmVudi5NQVhfQ09OVEVOVF9MRU5HVEggPyBwYXJzZUludChwcm9jZXNzLmVudi5NQVhfQ09OVEVOVF9MRU5HVEgpIDogODAwLFxuICAgIE1JTl9DT05URU5UX0xFTkdUSDogcHJvY2Vzcy5lbnYuTUlOX0NPTlRFTlRfTEVOR1RIID8gcGFyc2VJbnQocHJvY2Vzcy5lbnYuTUlOX0NPTlRFTlRfTEVOR1RIKSA6IDUwLFxuICAgIERBVEFfRklMRV9QQVRIOiBwcm9jZXNzLmVudi5EQVRBX0ZJTEVfUEFUSCB8fCBcImFwcC9kYXRhL2RjYXN0YWxpYS5qc29uXCIsXG4gICAgTExNX1BST1ZJREVSOiBwcm9jZXNzLmVudi5MTE1fUFJPVklERVIgfHwgXCJvbGxhbWFcIixcbiAgICBFTUJFRERJTkdfTU9ERUw6IHByb2Nlc3MuZW52LkVNQkVERElOR19NT0RFTCB8fCBcIm1pc3RyYWxcIixcbiAgICBPUEVOQUlfRU1CRURESU5HX01PREVMOiBwcm9jZXNzLmVudi5PUEVOQUlfRU1CRURESU5HX01PREVMIHx8IFwidGV4dC1lbWJlZGRpbmctMy1zbWFsbFwiXG59O1xuXG4vLyBDYWNoZSBtYW5hZ2VtZW50XG5sZXQgdmVjdG9yU3RvcmUgPSBudWxsO1xubGV0IGxhc3REYXRhSGFzaCA9IG51bGw7XG5sZXQgbGFzdExvYWRUaW1lID0gbnVsbDtcblxuLy8gQ29udGVudCBjbGVhbmluZyBwYXR0ZXJucyAtIG9yZ2FuaXplZCBmb3IgYmV0dGVyIG1haW50YWluYWJpbGl0eVxuY29uc3QgQ0xFQU5JTkdfUEFUVEVSTlMgPSB7XG4gICAgLy8gSFRNTCBhbmQgbWFya3VwIHJlbW92YWxcbiAgICBodG1sVGFnczogLzxbXj5dKj4vZyxcbiAgICB3aGl0ZXNwYWNlOiAvXFxzKy9nLFxuXG4gICAgLy8gSmF2YVNjcmlwdCByZW1vdmFsIHBhdHRlcm5zXG4gICAgZnVuY3Rpb25zOiAvZnVuY3Rpb25cXHMrXFx3K1xccypcXChbXildKlxcKVxccypcXHtbXn1dKlxcfS9nLFxuICAgIGpxdWVyeTogL2pRdWVyeVxcKFteKV0qXFwpW147XSo7L2csXG4gICAgZ3RhZzogL2d0YWdcXChbXildKlxcKS9nLFxuICAgIGRhdGFMYXllcjogL3dpbmRvd1xcLmRhdGFMYXllclteO10qOy9nLFxuICAgIHNldFRpbWVvdXQ6IC9zZXRUaW1lb3V0XFwoW14pXSpcXCkvZyxcblxuICAgIC8vIENTUyByZW1vdmFsIHBhdHRlcm5zXG4gICAgY3NzUnVsZXM6IC9cXC5bYS16QS1aMC05Xy1dK1xccypcXHtbXn1dKlxcfS9nLFxuICAgIG1lZGlhUXVlcmllczogL0BtZWRpYVtefV0qXFx7W159XSpcXH0vZyxcblxuICAgIC8vIENvbW1vbiB1bndhbnRlZCBjb250ZW50IHBhdHRlcm5zXG4gICAgY29weXJpZ2h0OiAvwqkgXFxkezR9IFteLl0qL2csXG4gICAgbmF2aWdhdGlvbjogL1RvZ2dsZSBuYXZpZ2F0aW9uW14uXSovZyxcbiAgICBpZnJhbWVzOiAvPGlmcmFtZVtePl0qPi9nLFxuICAgIHNyY0F0dHJpYnV0ZXM6IC9zcmM9XCJbXlwiXSpcIi9nXG59O1xuXG4vLyBVbndhbnRlZCBwaHJhc2VzIHRoYXQgaW5kaWNhdGUgbG93LXF1YWxpdHkgY29udGVudFxuY29uc3QgRklMVEVSX1BIUkFTRVMgPSBbXG4gICAgXCJmdW5jdGlvblwiLCBcImpRdWVyeVwiLCBcImd0YWdcIiwgXCJzZXRUaW1lb3V0XCIsIFwiwqlcIixcbiAgICBcIlRvZ2dsZSBuYXZpZ2F0aW9uXCIsIFwiR2V0IGluIFRvdWNoXCIsIFwiU2VydmljZXNcIixcbiAgICBcIkFib3V0XCIsIFwiQ29udGFjdFwiLCBcIkluc3BpcmluZyBJbm5vdmF0aW9uXCJcbl07XG5cbi8qKlxuICogRW5oYW5jZWQgY29udGVudCBjbGVhbmluZyB3aXRoIGJldHRlciBlcnJvciBoYW5kbGluZyBhbmQgcGVyZm9ybWFuY2VcbiAqL1xuZnVuY3Rpb24gY2xlYW5Db250ZW50KGNvbnRlbnQpIHtcbiAgICBpZiAoIWNvbnRlbnQgfHwgdHlwZW9mIGNvbnRlbnQgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiBcIk5vIGNvbnRlbnQgYXZhaWxhYmxlXCI7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IGNsZWFuZWQgPSBjb250ZW50O1xuXG4gICAgICAgIC8vIEFwcGx5IGFsbCBjbGVhbmluZyBwYXR0ZXJuc1xuICAgICAgICBPYmplY3QudmFsdWVzKENMRUFOSU5HX1BBVFRFUk5TKS5mb3JFYWNoKHBhdHRlcm4gPT4ge1xuICAgICAgICAgICAgY2xlYW5lZCA9IGNsZWFuZWQucmVwbGFjZShwYXR0ZXJuLCBcIiBcIik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNwbGl0IGludG8gc2VudGVuY2VzIGFuZCBmaWx0ZXIgb3V0IHVud2FudGVkIGNvbnRlbnRcbiAgICAgICAgY29uc3Qgc2VudGVuY2VzID0gY2xlYW5lZFxuICAgICAgICAgICAgLnNwbGl0KC9bLiE/XS8pXG4gICAgICAgICAgICAubWFwKHNlbnRlbmNlID0+IHNlbnRlbmNlLnRyaW0oKSlcbiAgICAgICAgICAgIC5maWx0ZXIoc2VudGVuY2UgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChzZW50ZW5jZS5sZW5ndGggPCAxNSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIHVud2FudGVkIHBocmFzZXNcbiAgICAgICAgICAgICAgICBjb25zdCBsb3dlclNlbnRlbmNlID0gc2VudGVuY2UudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gIUZJTFRFUl9QSFJBU0VTLnNvbWUocGhyYXNlID0+XG4gICAgICAgICAgICAgICAgICAgIGxvd2VyU2VudGVuY2UuaW5jbHVkZXMocGhyYXNlLnRvTG93ZXJDYXNlKCkpXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFJlam9pbiBzZW50ZW5jZXNcbiAgICAgICAgY2xlYW5lZCA9IHNlbnRlbmNlcy5qb2luKFwiLiBcIikudHJpbSgpO1xuXG4gICAgICAgIC8vIEZhbGxiYWNrIGlmIGNsZWFuaW5nIHJlbW92ZWQgdG9vIG11Y2ggY29udGVudFxuICAgICAgICBpZiAoY2xlYW5lZC5sZW5ndGggPCBDT05GSUcuTUlOX0NPTlRFTlRfTEVOR1RIKSB7XG4gICAgICAgICAgICBjbGVhbmVkID0gY29udGVudFxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKENMRUFOSU5HX1BBVFRFUk5TLmh0bWxUYWdzLCBcIiBcIilcbiAgICAgICAgICAgICAgICAucmVwbGFjZShDTEVBTklOR19QQVRURVJOUy53aGl0ZXNwYWNlLCBcIiBcIilcbiAgICAgICAgICAgICAgICAudHJpbSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQXBwbHkgbGVuZ3RoIGxpbWl0c1xuICAgICAgICBpZiAoY2xlYW5lZC5sZW5ndGggPiBDT05GSUcuTUFYX0NPTlRFTlRfTEVOR1RIKSB7XG4gICAgICAgICAgICAvLyBUcnkgdG8gY3V0IGF0IHNlbnRlbmNlIGJvdW5kYXJ5XG4gICAgICAgICAgICBjb25zdCBjdXRQb2ludCA9IGNsZWFuZWQubGFzdEluZGV4T2YoXCIuIFwiLCBDT05GSUcuTUFYX0NPTlRFTlRfTEVOR1RIKTtcbiAgICAgICAgICAgIGNsZWFuZWQgPSBjdXRQb2ludCA+IENPTkZJRy5NQVhfQ09OVEVOVF9MRU5HVEggKiAwLjhcbiAgICAgICAgICAgICAgICA/IGNsZWFuZWQuc3Vic3RyaW5nKDAsIGN1dFBvaW50ICsgMSlcbiAgICAgICAgICAgICAgICA6IGNsZWFuZWQuc3Vic3RyaW5nKDAsIENPTkZJRy5NQVhfQ09OVEVOVF9MRU5HVEgpICsgXCIuLi5cIjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjbGVhbmVkIHx8IFwiTm8gbWVhbmluZ2Z1bCBjb250ZW50IGZvdW5kXCI7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY2xlYW5pbmcgY29udGVudDpcIiwgZXJyb3IubWVzc2FnZSk7XG5cbiAgICAgICAgLy8gUm9idXN0IGZhbGxiYWNrXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gY29udGVudFxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKENMRUFOSU5HX1BBVFRFUk5TLmh0bWxUYWdzLCBcIiBcIilcbiAgICAgICAgICAgICAgICAucmVwbGFjZShDTEVBTklOR19QQVRURVJOUy53aGl0ZXNwYWNlLCBcIiBcIilcbiAgICAgICAgICAgICAgICAudHJpbSgpXG4gICAgICAgICAgICAgICAgLnN1YnN0cmluZygwLCBDT05GSUcuTUFYX0NPTlRFTlRfTEVOR1RIKSArIFwiLi4uXCI7XG4gICAgICAgIH0gY2F0Y2ggKGZhbGxiYWNrRXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWxsYmFjayBjbGVhbmluZyBhbHNvIGZhaWxlZDpcIiwgZmFsbGJhY2tFcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICAgIHJldHVybiBcIkNvbnRlbnQgcHJvY2Vzc2luZyBmYWlsZWRcIjtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgZWZmaWNpZW50IGhhc2ggZm9yIGNoYW5nZSBkZXRlY3Rpb25cbiAqL1xuZnVuY3Rpb24gY3JlYXRlRGF0YUhhc2goZGF0YSkge1xuICAgIHRyeSB7XG4gICAgICAgIC8vIENyZWF0ZSBoYXNoIGZyb20gVVJMcywgY29udGVudCBsZW5ndGhzLCBhbmQgbW9kaWZpY2F0aW9uIGluZGljYXRvcnNcbiAgICAgICAgY29uc3QgaGFzaElucHV0ID0gZGF0YVxuICAgICAgICAgICAgLm1hcChlbnRyeSA9PiBgJHtlbnRyeS51cmwgfHwgJ25vLXVybCd9OiR7KGVudHJ5LmNvbnRlbnQgfHwgJycpLmxlbmd0aH1gKVxuICAgICAgICAgICAgLmpvaW4oJ3wnKTtcblxuICAgICAgICByZXR1cm4gY3J5cHRvXG4gICAgICAgICAgICAuY3JlYXRlSGFzaCgnbWQ1JylcbiAgICAgICAgICAgIC51cGRhdGUoaGFzaElucHV0KVxuICAgICAgICAgICAgLmRpZ2VzdCgnaGV4JylcbiAgICAgICAgICAgIC5zdWJzdHJpbmcoMCwgMTYpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjcmVhdGluZyBkYXRhIGhhc2g6XCIsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICByZXR1cm4gRGF0ZS5ub3coKS50b1N0cmluZygpOyAvLyBGYWxsYmFjayB0byB0aW1lc3RhbXBcbiAgICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGUgYW5kIGxvYWQgZGF0YSBmaWxlXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGxvYWREYXRhRmlsZSgpIHtcbiAgICB0cnkge1xuICAgICAgICAvLyBDaGVjayBpZiBmaWxlIGV4aXN0c1xuICAgICAgICBhd2FpdCBmcy5hY2Nlc3MoQ09ORklHLkRBVEFfRklMRV9QQVRIKTtcblxuICAgICAgICBjb25zdCBmaWxlQ29udGVudCA9IGF3YWl0IGZzLnJlYWRGaWxlKENPTkZJRy5EQVRBX0ZJTEVfUEFUSCwgXCJ1dGY4XCIpO1xuICAgICAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShmaWxlQ29udGVudCk7XG5cbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhIGZpbGUgbXVzdCBjb250YWluIGFuIGFycmF5XCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2coYOKckyBEYXRhIGZpbGUgbG9hZGVkOiAke2RhdGEubGVuZ3RofSBlbnRyaWVzYCk7XG4gICAgICAgIHJldHVybiBkYXRhO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdFTk9FTlQnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYERhdGEgZmlsZSBub3QgZm91bmQ6ICR7Q09ORklHLkRBVEFfRklMRV9QQVRIfWApO1xuICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgU3ludGF4RXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBKU09OIGluIGRhdGEgZmlsZTogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbn1cblxuLyoqXG4gKiBGaWx0ZXIgZGF0YSBiYXNlZCBvbiBjb250ZW50IHF1YWxpdHlcbiAqL1xuZnVuY3Rpb24gZmlsdGVyRGF0YUJ5UXVhbGl0eShkYXRhKSB7XG4gICAgY29uc3QgcXVhbGl0eUNoZWNrcyA9IHtcbiAgICAgICAgaGFzQ29udGVudDogZW50cnkgPT4gZW50cnkuY29udGVudCAmJiBlbnRyeS5jb250ZW50Lmxlbmd0aCA+IDAsXG4gICAgICAgIGhhc1VybDogZW50cnkgPT4gZW50cnkudXJsICYmIHR5cGVvZiBlbnRyeS51cmwgPT09ICdzdHJpbmcnLFxuICAgICAgICBoYXNNaW5MZW5ndGg6IGVudHJ5ID0+IGVudHJ5LmNvbnRlbnQubGVuZ3RoID49IENPTkZJRy5NSU5fQ09OVEVOVF9MRU5HVEgsXG4gICAgICAgIG5vdEVycm9yQ29udGVudDogZW50cnkgPT5cbiAgICAgICAgICAgICFlbnRyeS5jb250ZW50LmluY2x1ZGVzKFwiQ29udGVudCB1bmF2YWlsYWJsZVwiKSAmJlxuICAgICAgICAgICAgIWVudHJ5LmNvbnRlbnQuaW5jbHVkZXMoXCJObyBjb250ZW50IGF2YWlsYWJsZVwiKSAmJlxuICAgICAgICAgICAgIWVudHJ5LmNvbnRlbnQuaW5jbHVkZXMoXCJFcnJvciBwcm9jZXNzaW5nXCIpLFxuICAgICAgICBoYXNWYXJpZWRDb250ZW50OiBlbnRyeSA9PiB7XG4gICAgICAgICAgICAvLyBDaGVjayBmb3IgY29udGVudCBkaXZlcnNpdHkgKG5vdCBqdXN0IHJlcGVhdGVkIHBocmFzZXMpXG4gICAgICAgICAgICBjb25zdCB3b3JkcyA9IGVudHJ5LmNvbnRlbnQudG9Mb3dlckNhc2UoKS5zcGxpdCgvXFxzKy8pO1xuICAgICAgICAgICAgY29uc3QgdW5pcXVlV29yZHMgPSBuZXcgU2V0KHdvcmRzKTtcbiAgICAgICAgICAgIHJldHVybiB1bmlxdWVXb3Jkcy5zaXplID49IHdvcmRzLmxlbmd0aCAqIDAuMzsgLy8gQXQgbGVhc3QgMzAlIHVuaXF1ZSB3b3Jkc1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IGZpbHRlcmVkID0gZGF0YS5maWx0ZXIoKGVudHJ5LCBpbmRleCkgPT4ge1xuICAgICAgICBjb25zdCBjaGVja3MgPSBPYmplY3QuZW50cmllcyhxdWFsaXR5Q2hlY2tzKTtcbiAgICAgICAgY29uc3QgZmFpbGVkQ2hlY2tzID0gY2hlY2tzLmZpbHRlcigoW25hbWUsIGNoZWNrXSkgPT4gIWNoZWNrKGVudHJ5KSk7XG5cbiAgICAgICAgaWYgKGZhaWxlZENoZWNrcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhg4pqgIEZpbHRlcmluZyBlbnRyeSAke2luZGV4ICsgMX06IEZhaWxlZCAke2ZhaWxlZENoZWNrcy5tYXAoKFtuYW1lXSkgPT4gbmFtZSkuam9pbignLCAnKX1gKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xuXG4gICAgY29uc29sZS5sb2coYOKckyBRdWFsaXR5IGZpbHRlcjogJHtmaWx0ZXJlZC5sZW5ndGh9LyR7ZGF0YS5sZW5ndGh9IGVudHJpZXMgcGFzc2VkYCk7XG4gICAgcmV0dXJuIGZpbHRlcmVkO1xufVxuXG4vKipcbiAqIEluaXRpYWxpemUgZW1iZWRkaW5ncyBwcm92aWRlclxuICovXG5mdW5jdGlvbiBjcmVhdGVFbWJlZGRpbmdzKCkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHByb3ZpZGVyID0gQ09ORklHLkxMTV9QUk9WSURFUi50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgIHN3aXRjaCAocHJvdmlkZXIpIHtcbiAgICAgICAgICAgIGNhc2UgXCJvcGVuYWlcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE9wZW5BSUVtYmVkZGluZ3Moe1xuICAgICAgICAgICAgICAgICAgICBtb2RlbE5hbWU6IENPTkZJRy5PUEVOQUlfRU1CRURESU5HX01PREVMXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNhc2UgXCJvbGxhbWFcIjpcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBPbGxhbWFFbWJlZGRpbmdzKHtcbiAgICAgICAgICAgICAgICAgICAgbW9kZWw6IENPTkZJRy5FTUJFRERJTkdfTU9ERUxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjcmVhdGluZyBlbWJlZGRpbmdzIHByb3ZpZGVyOlwiLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgLy8gRmFsbGJhY2sgdG8gT2xsYW1hXG4gICAgICAgIHJldHVybiBuZXcgT2xsYW1hRW1iZWRkaW5ncyh7IG1vZGVsOiBcIm1pc3RyYWxcIiB9KTtcbiAgICB9XG59XG5cbi8qKlxuICogUHJvY2VzcyBkYXRhIGZvciB2ZWN0b3Igc3RvcmUgY3JlYXRpb25cbiAqL1xuZnVuY3Rpb24gcHJvY2Vzc0RhdGFGb3JWZWN0b3JTdG9yZShkYXRhKSB7XG4gICAgY29uc29sZS5sb2coXCLwn5SEIFByb2Nlc3NpbmcgY29udGVudC4uLlwiKTtcblxuICAgIGNvbnN0IHByb2Nlc3NlZCA9IGRhdGEubWFwKChlbnRyeSwgaW5kZXgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGNsZWFuZWQgPSBjbGVhbkNvbnRlbnQoZW50cnkuY29udGVudCk7XG5cbiAgICAgICAgICAgIGlmIChpbmRleCAlIDEwID09PSAwKSB7IC8vIExvZyBldmVyeSAxMHRoIGVudHJ5IHRvIGF2b2lkIHNwYW1cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgUHJvY2Vzc2luZyAke2luZGV4ICsgMX0vJHtkYXRhLmxlbmd0aH0uLi5gKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0ZXh0OiBjbGVhbmVkLFxuICAgICAgICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogZW50cnkudXJsLFxuICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbExlbmd0aDogZW50cnkuY29udGVudCA/IGVudHJ5LmNvbnRlbnQubGVuZ3RoIDogMCxcbiAgICAgICAgICAgICAgICAgICAgY2xlYW5lZExlbmd0aDogY2xlYW5lZC5sZW5ndGgsXG4gICAgICAgICAgICAgICAgICAgIGluZGV4OiBpbmRleFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIHByb2Nlc3NpbmcgZW50cnkgJHtpbmRleCArIDF9OmAsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0ZXh0OiBcIkVycm9yIHByb2Nlc3NpbmcgY29udGVudFwiLFxuICAgICAgICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogZW50cnkudXJsIHx8ICd1bmtub3duJyxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGluZGV4OiBpbmRleFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnN0IHRleHRzID0gcHJvY2Vzc2VkLm1hcChwID0+IHAudGV4dCk7XG4gICAgY29uc3QgbWV0YWRhdGFzID0gcHJvY2Vzc2VkLm1hcChwID0+IHAubWV0YWRhdGEpO1xuXG4gICAgY29uc29sZS5sb2coXCLinJMgQ29udGVudCBwcm9jZXNzaW5nIGNvbXBsZXRlZFwiKTtcbiAgICByZXR1cm4geyB0ZXh0cywgbWV0YWRhdGFzIH07XG59XG5cbi8qKlxuICogRGlzcG9zZSBvZiBleGlzdGluZyB2ZWN0b3Igc3RvcmUgdG8gZnJlZSBtZW1vcnlcbiAqL1xuZnVuY3Rpb24gZGlzcG9zZVZlY3RvclN0b3JlKCkge1xuICAgIGlmICh2ZWN0b3JTdG9yZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIvCfl5HvuI8gRGlzcG9zaW5nIG9sZCB2ZWN0b3Igc3RvcmVcIik7XG4gICAgICAgIHZlY3RvclN0b3JlID0gbnVsbDtcblxuICAgICAgICAvLyBGb3JjZSBnYXJiYWdlIGNvbGxlY3Rpb24gaWYgYXZhaWxhYmxlIChOb2RlLmpzIHdpdGggLS1leHBvc2UtZ2MpXG4gICAgICAgIGlmIChnbG9iYWwuZ2MpIHtcbiAgICAgICAgICAgIGdsb2JhbC5nYygpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIE1haW4gZnVuY3Rpb24gdG8gbG9hZCBhbmQgY3JlYXRlIHZlY3RvciBpbmRleFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9hZEluZGV4KCkge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIvCfmoAgU3RhcnRpbmcgdmVjdG9yIHN0b3JlIGNyZWF0aW9uLi4uXCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhg8J+TiyBDb25maWc6ICR7Q09ORklHLk1BWF9FTlRSSUVTfSBtYXggZW50cmllcywgJHtDT05GSUcuTExNX1BST1ZJREVSfSBwcm92aWRlcmApO1xuXG4gICAgICAgIC8vIExvYWQgYW5kIHZhbGlkYXRlIGRhdGFcbiAgICAgICAgY29uc3QgcmF3RGF0YSA9IGF3YWl0IGxvYWREYXRhRmlsZSgpO1xuXG4gICAgICAgIC8vIENoZWNrIGNhY2hlIHZhbGlkaXR5XG4gICAgICAgIGNvbnN0IGN1cnJlbnRIYXNoID0gY3JlYXRlRGF0YUhhc2gocmF3RGF0YSk7XG4gICAgICAgIGNvbnN0IGNhY2hlQWdlID0gbGFzdExvYWRUaW1lID8gRGF0ZS5ub3coKSAtIGxhc3RMb2FkVGltZSA6IEluZmluaXR5O1xuICAgICAgICBjb25zdCBtYXhDYWNoZUFnZSA9IDUgKiA2MCAqIDEwMDA7IC8vIDUgbWludXRlc1xuXG4gICAgICAgIGlmICh2ZWN0b3JTdG9yZSAmJlxuICAgICAgICAgICAgbGFzdERhdGFIYXNoID09PSBjdXJyZW50SGFzaCAmJlxuICAgICAgICAgICAgY2FjaGVBZ2UgPCBtYXhDYWNoZUFnZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCLinIUgVXNpbmcgY2FjaGVkIHZlY3RvciBzdG9yZVwiKTtcbiAgICAgICAgICAgIHJldHVybiB2ZWN0b3JTdG9yZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIERpc3Bvc2Ugb2xkIHZlY3RvciBzdG9yZVxuICAgICAgICBkaXNwb3NlVmVjdG9yU3RvcmUoKTtcblxuICAgICAgICAvLyBGaWx0ZXIgYW5kIGxpbWl0IGRhdGFcbiAgICAgICAgY29uc3QgcXVhbGl0eURhdGEgPSBmaWx0ZXJEYXRhQnlRdWFsaXR5KHJhd0RhdGEpO1xuICAgICAgICBjb25zdCBsaW1pdGVkRGF0YSA9IHF1YWxpdHlEYXRhLnNsaWNlKDAsIENPTkZJRy5NQVhfRU5UUklFUyk7XG5cbiAgICAgICAgaWYgKGxpbWl0ZWREYXRhLmxlbmd0aCA8IHF1YWxpdHlEYXRhLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYOKaoO+4jyBMaW1pdGVkIHRvICR7Q09ORklHLk1BWF9FTlRSSUVTfSBlbnRyaWVzICgke3F1YWxpdHlEYXRhLmxlbmd0aH0gYXZhaWxhYmxlKWApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxpbWl0ZWREYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gdmFsaWQgZGF0YSBlbnRyaWVzIGZvdW5kIGFmdGVyIGZpbHRlcmluZ1wiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFByb2Nlc3MgZGF0YVxuICAgICAgICBjb25zdCB7IHRleHRzLCBtZXRhZGF0YXMgfSA9IHByb2Nlc3NEYXRhRm9yVmVjdG9yU3RvcmUobGltaXRlZERhdGEpO1xuXG4gICAgICAgIC8vIENyZWF0ZSBlbWJlZGRpbmdzIGFuZCB2ZWN0b3Igc3RvcmVcbiAgICAgICAgY29uc29sZS5sb2coXCLwn5SkIENyZWF0aW5nIGVtYmVkZGluZ3MuLi5cIik7XG4gICAgICAgIGNvbnN0IGVtYmVkZGluZ3MgPSBjcmVhdGVFbWJlZGRpbmdzKCk7XG5cbiAgICAgICAgY29uc29sZS5sb2coXCLwn5OKIEJ1aWxkaW5nIHZlY3RvciBzdG9yZS4uLlwiKTtcbiAgICAgICAgdmVjdG9yU3RvcmUgPSBhd2FpdCBNZW1vcnlWZWN0b3JTdG9yZS5mcm9tVGV4dHModGV4dHMsIG1ldGFkYXRhcywgZW1iZWRkaW5ncyk7XG5cbiAgICAgICAgLy8gVXBkYXRlIGNhY2hlIGluZm9cbiAgICAgICAgbGFzdERhdGFIYXNoID0gY3VycmVudEhhc2g7XG4gICAgICAgIGxhc3RMb2FkVGltZSA9IERhdGUubm93KCk7XG5cbiAgICAgICAgY29uc3QgZHVyYXRpb24gPSAoKERhdGUubm93KCkgLSBzdGFydFRpbWUpIC8gMTAwMCkudG9GaXhlZCgyKTtcbiAgICAgICAgY29uc29sZS5sb2coYOKchSBWZWN0b3Igc3RvcmUgY3JlYXRlZCBzdWNjZXNzZnVsbHkgaW4gJHtkdXJhdGlvbn1zYCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OIIFByb2Nlc3NlZCAke2xpbWl0ZWREYXRhLmxlbmd0aH0gZW50cmllc2ApO1xuXG4gICAgICAgIHJldHVybiB2ZWN0b3JTdG9yZTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnN0IGR1cmF0aW9uID0gKChEYXRlLm5vdygpIC0gc3RhcnRUaW1lKSAvIDEwMDApLnRvRml4ZWQoMik7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBFcnJvciBpbiBsb2FkSW5kZXggYWZ0ZXIgJHtkdXJhdGlvbn1zOmAsIGVycm9yLm1lc3NhZ2UpO1xuXG4gICAgICAgIC8vIENsZWFuIHVwIG9uIGVycm9yXG4gICAgICAgIGRpc3Bvc2VWZWN0b3JTdG9yZSgpO1xuXG4gICAgICAgIC8vIFJlLXRocm93IHdpdGggbW9yZSBjb250ZXh0XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVmVjdG9yIHN0b3JlIGNyZWF0aW9uIGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cbn1cblxuLyoqXG4gKiBHZXQgY3VycmVudCB2ZWN0b3Igc3RvcmUgc3RhdHVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRWZWN0b3JTdG9yZVN0YXR1cygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBpc0xvYWRlZDogISF2ZWN0b3JTdG9yZSxcbiAgICAgICAgbGFzdExvYWRUaW1lLFxuICAgICAgICBsYXN0RGF0YUhhc2gsXG4gICAgICAgIGNvbmZpZzogQ09ORklHXG4gICAgfTtcbn1cblxuLyoqXG4gKiBGb3JjZSByZWZyZXNoIG9mIHZlY3RvciBzdG9yZVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVmcmVzaFZlY3RvclN0b3JlKCkge1xuICAgIGNvbnNvbGUubG9nKFwi8J+UhCBGb3JjaW5nIHZlY3RvciBzdG9yZSByZWZyZXNoLi4uXCIpO1xuICAgIGRpc3Bvc2VWZWN0b3JTdG9yZSgpO1xuICAgIGxhc3REYXRhSGFzaCA9IG51bGw7XG4gICAgbGFzdExvYWRUaW1lID0gbnVsbDtcbiAgICByZXR1cm4gYXdhaXQgbG9hZEluZGV4KCk7XG59XG5cbi8vIERlZmF1bHQgZXhwb3J0IGZvciBOZXh0LmpzIGNvbXBhdGliaWxpdHlcbmV4cG9ydCBkZWZhdWx0IHtcbiAgICBsb2FkSW5kZXgsXG4gICAgZ2V0VmVjdG9yU3RvcmVTdGF0dXMsXG4gICAgcmVmcmVzaFZlY3RvclN0b3JlXG59OyJdLCJuYW1lcyI6WyJPcGVuQUlFbWJlZGRpbmdzIiwiT2xsYW1hRW1iZWRkaW5ncyIsIk1lbW9yeVZlY3RvclN0b3JlIiwicHJvbWlzZXMiLCJmcyIsImNyeXB0byIsInBhdGgiLCJDT05GSUciLCJNQVhfRU5UUklFUyIsInByb2Nlc3MiLCJlbnYiLCJNQVhfVkVDVE9SX0VOVFJJRVMiLCJwYXJzZUludCIsIk1BWF9DT05URU5UX0xFTkdUSCIsIk1JTl9DT05URU5UX0xFTkdUSCIsIkRBVEFfRklMRV9QQVRIIiwiTExNX1BST1ZJREVSIiwiRU1CRURESU5HX01PREVMIiwiT1BFTkFJX0VNQkVERElOR19NT0RFTCIsInZlY3RvclN0b3JlIiwibGFzdERhdGFIYXNoIiwibGFzdExvYWRUaW1lIiwiQ0xFQU5JTkdfUEFUVEVSTlMiLCJodG1sVGFncyIsIndoaXRlc3BhY2UiLCJmdW5jdGlvbnMiLCJqcXVlcnkiLCJndGFnIiwiZGF0YUxheWVyIiwic2V0VGltZW91dCIsImNzc1J1bGVzIiwibWVkaWFRdWVyaWVzIiwiY29weXJpZ2h0IiwibmF2aWdhdGlvbiIsImlmcmFtZXMiLCJzcmNBdHRyaWJ1dGVzIiwiRklMVEVSX1BIUkFTRVMiLCJjbGVhbkNvbnRlbnQiLCJjb250ZW50IiwiY2xlYW5lZCIsIk9iamVjdCIsInZhbHVlcyIsImZvckVhY2giLCJwYXR0ZXJuIiwicmVwbGFjZSIsInNlbnRlbmNlcyIsInNwbGl0IiwibWFwIiwic2VudGVuY2UiLCJ0cmltIiwiZmlsdGVyIiwibGVuZ3RoIiwibG93ZXJTZW50ZW5jZSIsInRvTG93ZXJDYXNlIiwic29tZSIsInBocmFzZSIsImluY2x1ZGVzIiwiam9pbiIsImN1dFBvaW50IiwibGFzdEluZGV4T2YiLCJzdWJzdHJpbmciLCJlcnJvciIsImNvbnNvbGUiLCJtZXNzYWdlIiwiZmFsbGJhY2tFcnJvciIsImNyZWF0ZURhdGFIYXNoIiwiZGF0YSIsImhhc2hJbnB1dCIsImVudHJ5IiwidXJsIiwiY3JlYXRlSGFzaCIsInVwZGF0ZSIsImRpZ2VzdCIsIkRhdGUiLCJub3ciLCJ0b1N0cmluZyIsImxvYWREYXRhRmlsZSIsImFjY2VzcyIsImZpbGVDb250ZW50IiwicmVhZEZpbGUiLCJKU09OIiwicGFyc2UiLCJBcnJheSIsImlzQXJyYXkiLCJFcnJvciIsImxvZyIsImNvZGUiLCJTeW50YXhFcnJvciIsImZpbHRlckRhdGFCeVF1YWxpdHkiLCJxdWFsaXR5Q2hlY2tzIiwiaGFzQ29udGVudCIsImhhc1VybCIsImhhc01pbkxlbmd0aCIsIm5vdEVycm9yQ29udGVudCIsImhhc1ZhcmllZENvbnRlbnQiLCJ3b3JkcyIsInVuaXF1ZVdvcmRzIiwiU2V0Iiwic2l6ZSIsImZpbHRlcmVkIiwiaW5kZXgiLCJjaGVja3MiLCJlbnRyaWVzIiwiZmFpbGVkQ2hlY2tzIiwibmFtZSIsImNoZWNrIiwiY3JlYXRlRW1iZWRkaW5ncyIsInByb3ZpZGVyIiwibW9kZWxOYW1lIiwibW9kZWwiLCJwcm9jZXNzRGF0YUZvclZlY3RvclN0b3JlIiwicHJvY2Vzc2VkIiwidGV4dCIsIm1ldGFkYXRhIiwib3JpZ2luYWxMZW5ndGgiLCJjbGVhbmVkTGVuZ3RoIiwidGV4dHMiLCJwIiwibWV0YWRhdGFzIiwiZGlzcG9zZVZlY3RvclN0b3JlIiwiZ2xvYmFsIiwiZ2MiLCJsb2FkSW5kZXgiLCJzdGFydFRpbWUiLCJyYXdEYXRhIiwiY3VycmVudEhhc2giLCJjYWNoZUFnZSIsIkluZmluaXR5IiwibWF4Q2FjaGVBZ2UiLCJxdWFsaXR5RGF0YSIsImxpbWl0ZWREYXRhIiwic2xpY2UiLCJlbWJlZGRpbmdzIiwiZnJvbVRleHRzIiwiZHVyYXRpb24iLCJ0b0ZpeGVkIiwiZ2V0VmVjdG9yU3RvcmVTdGF0dXMiLCJpc0xvYWRlZCIsImNvbmZpZyIsInJlZnJlc2hWZWN0b3JTdG9yZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/indexer.js\n");

/***/ }),

/***/ "(api)/./pages/api/chat.js":
/*!***************************!*\
  !*** ./pages/api/chat.js ***!
  \***************************/
/***/ ((__webpack_module__, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(__webpack_module__, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _barrel_optimize_names_ChatOpenAI_langchain_openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! __barrel_optimize__?names=ChatOpenAI!=!@langchain/openai */ \"(api)/__barrel_optimize__?names=ChatOpenAI!=!./node_modules/@langchain/openai/index.js\");\n/* harmony import */ var _barrel_optimize_names_ChatOllama_langchain_ollama__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! __barrel_optimize__?names=ChatOllama!=!@langchain/ollama */ \"(api)/__barrel_optimize__?names=ChatOllama!=!./node_modules/@langchain/ollama/index.js\");\n/* harmony import */ var _lib_indexer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../lib/indexer.js */ \"(api)/./lib/indexer.js\");\n/* harmony import */ var p_retry__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! p-retry */ \"p-retry\");\n/* harmony import */ var _styles_globals_css__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../styles/globals.css */ \"(api)/./styles/globals.css\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_barrel_optimize_names_ChatOpenAI_langchain_openai__WEBPACK_IMPORTED_MODULE_0__, _barrel_optimize_names_ChatOllama_langchain_ollama__WEBPACK_IMPORTED_MODULE_1__, _lib_indexer_js__WEBPACK_IMPORTED_MODULE_2__, p_retry__WEBPACK_IMPORTED_MODULE_3__]);\n([_barrel_optimize_names_ChatOpenAI_langchain_openai__WEBPACK_IMPORTED_MODULE_0__, _barrel_optimize_names_ChatOllama_langchain_ollama__WEBPACK_IMPORTED_MODULE_1__, _lib_indexer_js__WEBPACK_IMPORTED_MODULE_2__, p_retry__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\nconst provider = process.env.LLM_PROVIDER || \"ollama\";\nconst model = provider === \"openai\" ? new _barrel_optimize_names_ChatOpenAI_langchain_openai__WEBPACK_IMPORTED_MODULE_0__.ChatOpenAI({\n    modelName: \"gpt-4\"\n}) : new _barrel_optimize_names_ChatOllama_langchain_ollama__WEBPACK_IMPORTED_MODULE_1__.ChatOllama({\n    model: \"mistral\"\n});\nlet cachedVectorStore = null;\nasync function createVectorStoreWithRetry() {\n    return (0,p_retry__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(async ()=>{\n        console.log(\"Loading vector store...\");\n        const store = await (0,_lib_indexer_js__WEBPACK_IMPORTED_MODULE_2__.loadIndex)();\n        console.log(\"Vector store loaded successfully\");\n        return store;\n    }, {\n        retries: 3,\n        onFailedAttempt: (error)=>{\n            console.warn(`Vector store creation attempt ${error.attemptNumber} failed. ${error.retriesLeft} retries left.`);\n        }\n    });\n}\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n    try {\n        const { question } = req.body;\n        console.log(\"Received question:\", question);\n        if (!question || !question.trim()) {\n            return res.status(400).json({\n                error: \"Question is required\"\n            });\n        }\n        // Create or use cached vector store\n        if (!cachedVectorStore) {\n            cachedVectorStore = await createVectorStoreWithRetry();\n        }\n        // Search for relevant content with reduced results for faster processing\n        console.log(\"Searching for relevant content...\");\n        const results = await cachedVectorStore.similaritySearch(question.trim(), 2);\n        console.log(\"Search results:\", results.length, \"items found\");\n        if (!results || results.length === 0) {\n            console.log(\"No search results found\");\n            return res.json({\n                answer: \"I couldn't find specific information about that in our database. Please try asking about Dcastalia's services, case studies, or company information.\"\n            });\n        }\n        // Prepare context from search results with length limit\n        const context = results.map((r)=>{\n            const content = r.pageContent || r.content || \"\";\n            const url = r.metadata?.url || r.url || \"\";\n            const limitedContent = content.length > 400 ? content.substring(0, 400) + \"...\" : content;\n            return `${url}\\n${limitedContent}`;\n        }).join(\"\\n\\n\");\n        console.log(\"Context length:\", context.length, \"characters\");\n        // Create a more focused and concise prompt\n        const systemPrompt = `You are a helpful AI assistant for Dcastalia, a software development company in Bangladesh. \nAnswer questions based ONLY on the provided context from dcastalia.com. \nKeep your answers concise (2-3 sentences maximum) and informative.\nIf the context doesn't contain enough information, say so politely.`;\n        const userPrompt = `Question: ${question.trim()}\\n\\nContext:\\n${context}`;\n        // Get response from the model with timeout\n        console.log(\"Calling AI model...\");\n        const response = await Promise.race([\n            model.call([\n                {\n                    role: \"system\",\n                    content: systemPrompt\n                },\n                {\n                    role: \"user\",\n                    content: userPrompt\n                }\n            ]),\n            new Promise((_, reject)=>setTimeout(()=>reject(new Error(\"Request timeout\")), 15000))\n        ]);\n        console.log(\"AI response received:\", response.content ? \"Yes\" : \"No\");\n        console.log(\"Response length:\", response.content ? response.content.length : 0);\n        if (!response.content) {\n            throw new Error(\"No content received from AI model\");\n        }\n        res.json({\n            answer: response.content\n        });\n    } catch (error) {\n        console.error(\"Chat API Error:\", error);\n        console.error(\"Error stack:\", error.stack);\n        // Handle specific error types\n        if (error.message && error.message.includes(\"input length exceeds maximum context length\")) {\n            return res.status(500).json({\n                error: \"The content is too long to process. Please try a more specific question about Dcastalia.\"\n            });\n        }\n        if (error.message && error.message.includes(\"Failed to fetch\")) {\n            return res.status(500).json({\n                error: \"Unable to connect to the AI service. Please check your configuration and try again.\"\n            });\n        }\n        if (error.message && error.message.includes(\"Request timeout\")) {\n            return res.status(500).json({\n                error: \"Request timed out. Please try again with a simpler question.\"\n            });\n        }\n        res.status(500).json({\n            error: \"An error occurred while processing your request. Please try again.\"\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SSxDQUFDO1lBQ2xCVCxPQUFPO1FBQ1Y7SUFDSDtBQUNIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZGNhc3RhbGlhLWNoYXRib3QvLi9wYWdlcy9hcGkvY2hhdC5qcz8xYzQ5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYXRPcGVuQUkgfSBmcm9tIFwiQGxhbmdjaGFpbi9vcGVuYWlcIjtcbmltcG9ydCB7IENoYXRPbGxhbWEgfSBmcm9tIFwiQGxhbmdjaGFpbi9vbGxhbWFcIjtcbmltcG9ydCB7IGxvYWRJbmRleCB9IGZyb20gXCIuLi8uLi9saWIvaW5kZXhlci5qc1wiO1xuaW1wb3J0IHBSZXRyeSBmcm9tICdwLXJldHJ5JztcbmltcG9ydCAnLi4vLi4vc3R5bGVzL2dsb2JhbHMuY3NzJztcblxuXG5jb25zdCBwcm92aWRlciA9IHByb2Nlc3MuZW52LkxMTV9QUk9WSURFUiB8fCBcIm9sbGFtYVwiO1xuY29uc3QgbW9kZWwgPSBwcm92aWRlciA9PT0gXCJvcGVuYWlcIiA/IG5ldyBDaGF0T3BlbkFJKHsgbW9kZWxOYW1lOiBcImdwdC00XCIgfSkgOiBuZXcgQ2hhdE9sbGFtYSh7IG1vZGVsOiBcIm1pc3RyYWxcIiB9KTtcblxubGV0IGNhY2hlZFZlY3RvclN0b3JlID0gbnVsbDtcblxuYXN5bmMgZnVuY3Rpb24gY3JlYXRlVmVjdG9yU3RvcmVXaXRoUmV0cnkoKSB7XG4gIHJldHVybiBwUmV0cnkoXG4gICAgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coXCJMb2FkaW5nIHZlY3RvciBzdG9yZS4uLlwiKTtcbiAgICAgIGNvbnN0IHN0b3JlID0gYXdhaXQgbG9hZEluZGV4KCk7XG4gICAgICBjb25zb2xlLmxvZyhcIlZlY3RvciBzdG9yZSBsb2FkZWQgc3VjY2Vzc2Z1bGx5XCIpO1xuICAgICAgcmV0dXJuIHN0b3JlO1xuICAgIH0sXG4gICAge1xuICAgICAgcmV0cmllczogMyxcbiAgICAgIG9uRmFpbGVkQXR0ZW1wdDogZXJyb3IgPT4ge1xuICAgICAgICBjb25zb2xlLndhcm4oYFZlY3RvciBzdG9yZSBjcmVhdGlvbiBhdHRlbXB0ICR7ZXJyb3IuYXR0ZW1wdE51bWJlcn0gZmFpbGVkLiAke2Vycm9yLnJldHJpZXNMZWZ0fSByZXRyaWVzIGxlZnQuYCk7XG4gICAgICB9LFxuICAgIH1cbiAgKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXEsIHJlcykge1xuICAgaWYgKHJlcS5tZXRob2QgIT09IFwiUE9TVFwiKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLmpzb24oeyBlcnJvcjogXCJNZXRob2Qgbm90IGFsbG93ZWRcIiB9KTtcbiAgIH1cblxuICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgcXVlc3Rpb24gfSA9IHJlcS5ib2R5O1xuICAgICAgY29uc29sZS5sb2coXCJSZWNlaXZlZCBxdWVzdGlvbjpcIiwgcXVlc3Rpb24pO1xuXG4gICAgICBpZiAoIXF1ZXN0aW9uIHx8ICFxdWVzdGlvbi50cmltKCkpIHtcbiAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiBcIlF1ZXN0aW9uIGlzIHJlcXVpcmVkXCIgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENyZWF0ZSBvciB1c2UgY2FjaGVkIHZlY3RvciBzdG9yZVxuICAgICAgaWYgKCFjYWNoZWRWZWN0b3JTdG9yZSkge1xuICAgICAgICBjYWNoZWRWZWN0b3JTdG9yZSA9IGF3YWl0IGNyZWF0ZVZlY3RvclN0b3JlV2l0aFJldHJ5KCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFNlYXJjaCBmb3IgcmVsZXZhbnQgY29udGVudCB3aXRoIHJlZHVjZWQgcmVzdWx0cyBmb3IgZmFzdGVyIHByb2Nlc3NpbmdcbiAgICAgIGNvbnNvbGUubG9nKFwiU2VhcmNoaW5nIGZvciByZWxldmFudCBjb250ZW50Li4uXCIpO1xuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IGNhY2hlZFZlY3RvclN0b3JlLnNpbWlsYXJpdHlTZWFyY2gocXVlc3Rpb24udHJpbSgpLCAyKTtcbiAgICAgIGNvbnNvbGUubG9nKFwiU2VhcmNoIHJlc3VsdHM6XCIsIHJlc3VsdHMubGVuZ3RoLCBcIml0ZW1zIGZvdW5kXCIpO1xuXG4gICAgICBpZiAoIXJlc3VsdHMgfHwgcmVzdWx0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgIGNvbnNvbGUubG9nKFwiTm8gc2VhcmNoIHJlc3VsdHMgZm91bmRcIik7XG4gICAgICAgICByZXR1cm4gcmVzLmpzb24oe1xuICAgICAgICAgICAgYW5zd2VyOiBcIkkgY291bGRuJ3QgZmluZCBzcGVjaWZpYyBpbmZvcm1hdGlvbiBhYm91dCB0aGF0IGluIG91ciBkYXRhYmFzZS4gUGxlYXNlIHRyeSBhc2tpbmcgYWJvdXQgRGNhc3RhbGlhJ3Mgc2VydmljZXMsIGNhc2Ugc3R1ZGllcywgb3IgY29tcGFueSBpbmZvcm1hdGlvbi5cIixcbiAgICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBQcmVwYXJlIGNvbnRleHQgZnJvbSBzZWFyY2ggcmVzdWx0cyB3aXRoIGxlbmd0aCBsaW1pdFxuICAgICAgY29uc3QgY29udGV4dCA9IHJlc3VsdHNcbiAgICAgICAgIC5tYXAoKHIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSByLnBhZ2VDb250ZW50IHx8IHIuY29udGVudCB8fCBcIlwiO1xuICAgICAgICAgICAgY29uc3QgdXJsID0gci5tZXRhZGF0YT8udXJsIHx8IHIudXJsIHx8IFwiXCI7XG4gICAgICAgICAgICBjb25zdCBsaW1pdGVkQ29udGVudCA9IGNvbnRlbnQubGVuZ3RoID4gNDAwID8gY29udGVudC5zdWJzdHJpbmcoMCwgNDAwKSArIFwiLi4uXCIgOiBjb250ZW50O1xuICAgICAgICAgICAgcmV0dXJuIGAke3VybH1cXG4ke2xpbWl0ZWRDb250ZW50fWA7XG4gICAgICAgICB9KVxuICAgICAgICAgLmpvaW4oXCJcXG5cXG5cIik7XG5cbiAgICAgIGNvbnNvbGUubG9nKFwiQ29udGV4dCBsZW5ndGg6XCIsIGNvbnRleHQubGVuZ3RoLCBcImNoYXJhY3RlcnNcIik7XG5cbiAgICAgIC8vIENyZWF0ZSBhIG1vcmUgZm9jdXNlZCBhbmQgY29uY2lzZSBwcm9tcHRcbiAgICAgIGNvbnN0IHN5c3RlbVByb21wdCA9IGBZb3UgYXJlIGEgaGVscGZ1bCBBSSBhc3Npc3RhbnQgZm9yIERjYXN0YWxpYSwgYSBzb2Z0d2FyZSBkZXZlbG9wbWVudCBjb21wYW55IGluIEJhbmdsYWRlc2guIFxuQW5zd2VyIHF1ZXN0aW9ucyBiYXNlZCBPTkxZIG9uIHRoZSBwcm92aWRlZCBjb250ZXh0IGZyb20gZGNhc3RhbGlhLmNvbS4gXG5LZWVwIHlvdXIgYW5zd2VycyBjb25jaXNlICgyLTMgc2VudGVuY2VzIG1heGltdW0pIGFuZCBpbmZvcm1hdGl2ZS5cbklmIHRoZSBjb250ZXh0IGRvZXNuJ3QgY29udGFpbiBlbm91Z2ggaW5mb3JtYXRpb24sIHNheSBzbyBwb2xpdGVseS5gO1xuXG4gICAgICBjb25zdCB1c2VyUHJvbXB0ID0gYFF1ZXN0aW9uOiAke3F1ZXN0aW9uLnRyaW0oKX1cXG5cXG5Db250ZXh0OlxcbiR7Y29udGV4dH1gO1xuXG4gICAgICAvLyBHZXQgcmVzcG9uc2UgZnJvbSB0aGUgbW9kZWwgd2l0aCB0aW1lb3V0XG4gICAgICBjb25zb2xlLmxvZyhcIkNhbGxpbmcgQUkgbW9kZWwuLi5cIik7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IFByb21pc2UucmFjZShbXG4gICAgICAgICBtb2RlbC5jYWxsKFtcbiAgICAgICAgICAgIHsgcm9sZTogXCJzeXN0ZW1cIiwgY29udGVudDogc3lzdGVtUHJvbXB0IH0sXG4gICAgICAgICAgICB7IHJvbGU6IFwidXNlclwiLCBjb250ZW50OiB1c2VyUHJvbXB0IH0sXG4gICAgICAgICBdKSxcbiAgICAgICAgIG5ldyBQcm9taXNlKChfLCByZWplY3QpID0+IHNldFRpbWVvdXQoKCkgPT4gcmVqZWN0KG5ldyBFcnJvcihcIlJlcXVlc3QgdGltZW91dFwiKSksIDE1MDAwKSksXG4gICAgICBdKTtcblxuICAgICAgY29uc29sZS5sb2coXCJBSSByZXNwb25zZSByZWNlaXZlZDpcIiwgcmVzcG9uc2UuY29udGVudCA/IFwiWWVzXCIgOiBcIk5vXCIpO1xuICAgICAgY29uc29sZS5sb2coXCJSZXNwb25zZSBsZW5ndGg6XCIsIHJlc3BvbnNlLmNvbnRlbnQgPyByZXNwb25zZS5jb250ZW50Lmxlbmd0aCA6IDApO1xuXG4gICAgICBpZiAoIXJlc3BvbnNlLmNvbnRlbnQpIHtcbiAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIGNvbnRlbnQgcmVjZWl2ZWQgZnJvbSBBSSBtb2RlbFwiKTtcbiAgICAgIH1cblxuICAgICAgcmVzLmpzb24oeyBhbnN3ZXI6IHJlc3BvbnNlLmNvbnRlbnQgfSk7XG4gICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkNoYXQgQVBJIEVycm9yOlwiLCBlcnJvcik7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc3RhY2s6XCIsIGVycm9yLnN0YWNrKTtcblxuICAgICAgLy8gSGFuZGxlIHNwZWNpZmljIGVycm9yIHR5cGVzXG4gICAgICBpZiAoZXJyb3IubWVzc2FnZSAmJiBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKFwiaW5wdXQgbGVuZ3RoIGV4Y2VlZHMgbWF4aW11bSBjb250ZXh0IGxlbmd0aFwiKSkge1xuICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgICAgIGVycm9yOiBcIlRoZSBjb250ZW50IGlzIHRvbyBsb25nIHRvIHByb2Nlc3MuIFBsZWFzZSB0cnkgYSBtb3JlIHNwZWNpZmljIHF1ZXN0aW9uIGFib3V0IERjYXN0YWxpYS5cIixcbiAgICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoZXJyb3IubWVzc2FnZSAmJiBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKFwiRmFpbGVkIHRvIGZldGNoXCIpKSB7XG4gICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICAgICAgZXJyb3I6IFwiVW5hYmxlIHRvIGNvbm5lY3QgdG8gdGhlIEFJIHNlcnZpY2UuIFBsZWFzZSBjaGVjayB5b3VyIGNvbmZpZ3VyYXRpb24gYW5kIHRyeSBhZ2Fpbi5cIixcbiAgICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoZXJyb3IubWVzc2FnZSAmJiBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKFwiUmVxdWVzdCB0aW1lb3V0XCIpKSB7XG4gICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICAgICAgZXJyb3I6IFwiUmVxdWVzdCB0aW1lZCBvdXQuIFBsZWFzZSB0cnkgYWdhaW4gd2l0aCBhIHNpbXBsZXIgcXVlc3Rpb24uXCIsXG4gICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICAgZXJyb3I6IFwiQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgcHJvY2Vzc2luZyB5b3VyIHJlcXVlc3QuIFBsZWFzZSB0cnkgYWdhaW4uXCIsXG4gICAgICB9KTtcbiAgIH1cbn1cbiJdLCJuYW1lcyI6WyJDaGF0T3BlbkFJIiwiQ2hhdE9sbGFtYSIsImxvYWRJbmRleCIsInBSZXRyeSIsInByb3ZpZGVyIiwicHJvY2VzcyIsImVudiIsIkxMTV9QUk9WSURFUiIsIm1vZGVsIiwibW9kZWxOYW1lIiwiY2FjaGVkVmVjdG9yU3RvcmUiLCJjcmVhdGVWZWN0b3JTdG9yZVdpdGhSZXRyeSIsImNvbnNvbGUiLCJsb2ciLCJzdG9yZSIsInJldHJpZXMiLCJvbkZhaWxlZEF0dGVtcHQiLCJlcnJvciIsIndhcm4iLCJhdHRlbXB0TnVtYmVyIiwicmV0cmllc0xlZnQiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwibWV0aG9kIiwic3RhdHVzIiwianNvbiIsInF1ZXN0aW9uIiwiYm9keSIsInRyaW0iLCJyZXN1bHRzIiwic2ltaWxhcml0eVNlYXJjaCIsImxlbmd0aCIsImFuc3dlciIsImNvbnRleHQiLCJtYXAiLCJyIiwiY29udGVudCIsInBhZ2VDb250ZW50IiwidXJsIiwibWV0YWRhdGEiLCJsaW1pdGVkQ29udGVudCIsInN1YnN0cmluZyIsImpvaW4iLCJzeXN0ZW1Qcm9tcHQiLCJ1c2VyUHJvbXB0IiwicmVzcG9uc2UiLCJQcm9taXNlIiwicmFjZSIsImNhbGwiLCJyb2xlIiwiXyIsInJlamVjdCIsInNldFRpbWVvdXQiLCJFcnJvciIsInN0YWNrIiwibWVzc2FnZSIsImluY2x1ZGVzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/chat.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@langchain"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fchat.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();